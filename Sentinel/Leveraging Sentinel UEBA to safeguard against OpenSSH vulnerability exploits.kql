// Leveraging Sentinel UEBA to safeguard against OpenSSH vulnerability exploits 
// https://www.linkedin.com/posts/activity-7217745435635900416-ZIa7/

// Using Sentinel UEBA threat intelligence data, you can identify the IP addresses of SSH BruteForce attackers targeting your cloud or on-premises environment. By adding these IPs to your firewall block list, you can enhance protection against OpenSSH vulnerability exploits, specifically CVE-2024-6387 (hashtag#RegreSSHion) and CVE-2024-6409 (hashtag#Privsep).

BehaviorAnalytics
| where TimeGenerated > ago(90d)
| extend ThreatIntelIndicatorDescription = DevicesInsights.ThreatIntelIndicatorDescription
| where isnotempty( ThreatIntelIndicatorDescription ) 
| where ThreatIntelIndicatorDescription contains "destination_port_numbers: 22" and 
ThreatIntelIndicatorDescription contains "A BruteForce indicator"
| distinct SourceIPAddress, SourceIPLocation
| sort by SourceIPLocation asc

// MITRE ATT&CK Mapping

// The KQL query is designed to detect brute force attacks on SSH (port 22). This can be mapped to the following MITRE ATT&CK techniques:

// T1110.001 - Brute Force: Password Guessing:
// The query looks for indicators of brute force attacks, which aligns with the technique of attempting to guess passwords to gain unauthorized access.
// T1040 - Network Sniffing:
// While not directly related to brute force, monitoring port 22 can also help detect network sniffing activities aimed at capturing credentials.
// T1078 - Valid Accounts:
// Successful brute force attacks may lead to the use of valid accounts, which is another technique in the MITRE ATT&CK framework.
